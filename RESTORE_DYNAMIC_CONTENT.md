# Восстановление динамического функционала после build

## Проблема
После выполнения `npm run build` динамический функционал (туры, виды туров, страны) перестал работать, потому что статические HTML файлы перезаписывают динамический контент.

## Решение

### 1. Пересобрать статические файлы (только ресурсы)
```bash
npm run build
```

Это скопирует CSS, JS и изображения в `public/static/`, но HTML файлы будут содержать динамический JavaScript код.

### 2. Перезапустить сервер
```bash
pm2 restart all
```

### 3. Проверить, что работает

#### Проверка API:
- Откройте: `https://lovimoment-travel.com/api/countries` - должны вернуться страны
- Откройте: `https://lovimoment-travel.com/api/tour-types` - должны вернуться виды туров
- Откройте: `https://lovimoment-travel.com/api/tours` - должны вернуться туры

#### Проверка страниц:
- Главная страница: должны загружаться карточки стран и виды туров
- Страница `/tour/`: должны загружаться туры из базы данных
- Страница `/tour-about/:slug`: должна загружаться информация о туре

### 4. Если проблема сохраняется

#### Проверьте консоль браузера (F12):
- Должны быть сообщения: `=== Загрузка стран ===`, `=== Загрузка видов туров ===`
- Не должно быть ошибок 404 для `/api/countries`, `/api/tour-types`, `/api/tours`

#### Проверьте логи сервера:
```bash
pm2 logs --lines 50
```

Должны быть логи:
- `[API /api/countries] Найдено активных стран: X`
- `Подключение к базе данных установлено успешно`

#### Проверьте, что HTML файлы содержат JavaScript:
```bash
grep -r "loadCountries\|loadTourTypes" public/index.html
grep -r "fetch.*api" public/tour/index.html
```

Должны найтись функции загрузки данных.

### 5. Если ничего не помогает

Восстановите из git:
```bash
cd /var/www/lovi_moment228
git stash  # Сохранить текущие изменения
git pull origin main
npm run build
pm2 restart all
```

## Важно!

**НЕ удаляйте папку `public/` полностью!** В ней хранятся:
- Загруженные изображения туров (`public/static/images/tours/`)
- Загруженные баннеры стран (`public/static/images/countries/`)
- Админ-панель (`public/admin/`)

`build-static.js` настроен так, чтобы НЕ удалять эти файлы.

