# Lovi Moment Travel - Node.js версия

Статический сайт для туристической компании Lovi Moment, перенесенный с Django на Node.js.

## Установка

1. Установите зависимости:
```bash
npm install
```

2. Создайте файл `.env` на основе `.env.example`:
```bash
# Windows (PowerShell)
Copy-Item .env.example .env

# Linux/Mac
cp .env.example .env
```

3. Настройте переменные окружения в `.env` файле:
   - Настройте подключение к PostgreSQL (DB_NAME, DB_USER, DB_PASSWORD, DB_HOST, DB_PORT)
   - Настройте email для отправки заявок (EMAIL_USER, EMAIL_PASSWORD, RECIPIENT_EMAIL)
   - Измените SESSION_SECRET на случайную строку (обязательно!)
   - При необходимости включите AUTO_SYNC_DB=true для автоматической синхронизации БД

## Настройка базы данных

1. Создайте базу данных PostgreSQL:
```sql
CREATE DATABASE lovi_moment;
```

2. Настройте `.env` файл с параметрами подключения к БД

3. Синхронизируйте базу данных:
```bash
npm run sync-db
```

**Варианты синхронизации:**
- `npm run sync-db` - обычная синхронизация (создает только отсутствующие таблицы)
- `npm run sync-db:alter` - синхронизация с изменением структуры
- `npm run sync-db:force` - принудительная синхронизация (⚠️ удаляет все данные!)

4. Создайте первого администратора:
```bash
npm run init-admin
```

## Генерация статических файлов

Перед запуском сервера необходимо сгенерировать статические HTML файлы из Django шаблонов:

```bash
npm run build
```

Этот скрипт:
- Читает все HTML шаблоны из `main/templates/`
- Заменяет Django теги (`{% static %}`, `{% url %}`) на относительные пути
- Копирует статические файлы (CSS, JS, изображения) в `public/static/`
- Создает структуру папок с `index.html` файлами в `public/`

## Запуск сервера

### Режим разработки (с автоперезагрузкой):
```bash
npm run dev
```

### Продакшн режим:
```bash
npm start
```

Сервер будет доступен по адресу: `http://localhost:3000`

## Структура проекта

```
lovi_moment/
├── main/
│   └── templates/          # Django шаблоны (исходники)
├── static/                  # Статические файлы (CSS, JS, изображения)
├── public/                  # Сгенерированные статические HTML файлы
├── server.js                # Express сервер
├── build-static.js          # Скрипт для генерации статических файлов
├── package.json
└── .env                     # Переменные окружения
```

## API Endpoints

### POST /submit-application
Обработка формы заявки на тур.

**Параметры:**
- `name` (обязательно) - Имя клиента
- `phone` (обязательно) - Номер телефона
- `email` (опционально) - Email адрес
- `consent` (обязательно) - Согласие на обработку данных

**Ответ:**
```json
{
  "status": "ok"
}
```

или

```json
{
  "status": "error",
  "error": "описание ошибки"
}
```

## Особенности

- Все Django шаблоны автоматически преобразуются в статические HTML
- Относительные пути к статическим файлам вычисляются автоматически
- Поддержка всех маршрутов из Django проекта
- API endpoint для обработки форм с отправкой email через Nodemailer
